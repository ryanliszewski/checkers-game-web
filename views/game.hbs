<div class="container">
  <div class="row">
    <div class="col-8">
      <a href="/lobby" class="pull-right btn btn-lg btn-warning" data-original-title="" title=""><i class="fa fa-sign-out" aria-hidden="true"></i>  Leave Game</a>
      <div class="chat-room">
        <div id="game">
          <div id="board"></div>
          <div id="pieces"></div>
        </div>
      </div>
    </div>

    <div class="col-4">
      <div class="message-box">
        <ul id="messages"></ul>
      </div>

      <form class="form-chat form-inline" action="">
        <div class="form-group">
          <input id="input-box" class="form-control input-lg" autocomplete="off" />
        </div>
        <button class="btn-lg btn-info">Send</button>
      </form>
    </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Game Over!</h5>
      </div>
      <div class="modal-body">
        <h3 id = "modalBodyText"></h3>
      </div>
      <div class="modal-footer">
        <a href="/lobby">
        <button type="button" class="btn btn-primary" data-dismiss="/lobby"> Go To Lobby</button>
        </a>
      </div>
    </div>
  </div>
</div>

  </div>
</div>

<script type="text/javascript" src="/js/socket.io.js"></script>
<script type="text/javascript" src="/js/checkerLogic.js"></script>
<script type="text/javascript" src="/js/checkers.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
  var socket = io('/game');
  let gameCode;
  var obj;

  function guid() {
    function s4() {
      return Math.floor((1 + Math.random()) * 0x10000)
        .toString(16)
        .substring(1);
    }
    return s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4();
  }

  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      if (pair[0] == variable) {
        return pair[1];
      }
    }
    return (false);
  }

  $(function() {
    gameCode = getQueryVariable('gameID');
    if (!gameCode) {
      gameCode = guid();
    }
    obj = {
      name: '{{user.username}}',
      gameID: gameCode,
      isGameFull: getQueryVariable('isGameFull')
    };
    console.log('Game Object: ', obj);
    socket.on('connect', function() {
      console.log("Connected to server!");
      console.log("Socket ID: ", socket.id);
      console.log("Game ID", obj.gameID)
      socket.emit('join', obj, function(err) {
        if (err) {
          alert(err);
        } else {
          console.log('No error');
        }
      });
    });

    $('form').submit(function() {
      socket.emit(obj.gameID, '{{user.username}}: ' + $('#input-box').val());
      $('#input-box').val('');
      console.log("Room : ", obj.gameID);
      return false;
    });

    socket.on(obj.gameID, function(msg) {
      console.log("Message Received:", msg);

      if (msg == 'Player YOUR TURN!') {
        $('#messages').append($('<li class="your-turn">').text(msg));
      } else if (msg == 'Player has LEFT GAME!') {
        $('#messages').append($('<li class="player-exit">').text(msg));
      } else {
        $('#messages').append($('<li>').text(msg));
      }
      window.scrollTo(0, document.body.scrollHeight);
    });

  });
</script>
