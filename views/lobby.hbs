<!doctype html>
<html>

<head>
  <title>{{title}}</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></link>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel='stylesheet' href='/stylesheets/lobby.css' />
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="game-list"></div>
        <div class="chat-room">
          <ul id="gameGenerate"></ul>

          <div class="game-list">
            <h3>Games</h3>
            <ul id="games">
            </ul>
          </div>

          <div class="message-box">
            <ul id="messages"></ul>
          </div>

          <form class="form-chat form-inline" action="">
            <div class="form-group">
              <input id="input-box" class="form-control input-lg" autocomplete="off" />
            </div>
            <button class="btn-lg">Send</button>
          </form>

        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="/js/socket.io.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
    function guid() {
      function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(1);
      }
      return s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4();
    }

    document.getElementById("gameGenerate").innerHTML = ' <a href="/game?gameID=' +
      guid() + '&isGameFull=false' + '" class="pull-right btn btn-default" data-original-title="" title="">+ Create Game</a>';

    $(function() {
      var socket = io();
      socket.on('gameListActive', function(gameList) {
        var temp = JSON.parse(gameList);
        var gameListArray = JSON.parse("[" + temp + "]");
        for (var i = 0; i < gameListArray[0].length &&
          gameListArray[0][i]['isGameFull'] == false; i++) {
          console.log(gameListArray[0][i]['isGameFull']);
          $('#games').append($('<li>' + gameListArray[0][i]['gameCreator'] + ' <a href="/game?gameID=' +
            gameListArray[0][i]['gameId'] + '&isGameFull=true' +
            '" class="btn btn-default pull-right">+ Join Game </a>'));
        }
      });

      $('form').submit(function() {
        socket.emit('lobbyChat', '{{user.username}}: ' + $('#input-box').val());
        $('#input-box').val('');
        return false;
      });
      socket.on('lobbyChat', function(msg) {
        $('#messages').append($('<li>').text(msg));
        window.scrollTo(0, document.body.scrollHeight);
      });
    });
  </script>
</body>

</html>
